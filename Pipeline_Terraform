pipeline {
  agent any
  tools {
  terraform 'myterraform'
}
  stages {
    stage('fetch_latest_code') {
      steps {
        git branch: 'main', url: 'https://github.com/Timojeaga/Final_project_submission.git'
      }
    }
    stage('Provision Infrastructure with Terraform') {
      steps {
        script {
          // Define Terraform directory
          def terraformDir = '/var/lib/jenkins/workspace/myterraform/terraform/'

          // Change to the Terraform directory
          dir(terraformDir) {
            // Run Terraform commands
            sh 'sudo terraform init'
            sh 'sudo terraform plan'
            sh 'sudo terraform apply -auto-approve'
          }
        }
      }
    }
  }
}
